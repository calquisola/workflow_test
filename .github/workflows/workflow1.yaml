name: Retag Images

on:
  workflow_call:
    inputs:
      prod-release:
        description: True if this is initiated from a production release
        required: false
        default: false
        type: boolean
      app-version:
        description: App version value
        required: false
        type: string
jobs:
  test:
    name: Test inputs
    runs-on: ubuntu-22.04
    outputs:
      version: ${{ steps.set-latest.outputs.value }}${{ steps.set-version.outputs.value }}
    steps:
    - name: Set output to 'latest'
      id: set-latest
      if: >-
        inputs.prod-release ||
        (inputs.app-version == '' || inputs.app-version == 'null') &&
        (!inputs.prod-release || inputs.prod-release == 'null')
      run: echo "value=latest" >> $GITHUB_OUTPUT

    - name: Set output to app version
      id: set-version
      if: >-
        !inputs.prod-release &&
        inputs.app-version != '' && inputs.app-version != 'null'
      run: echo "value=${{ inputs.app-version }}" >> $GITHUB_OUTPUT

  print-version:
    runs-on: ubuntu-22.04
    name: Print Version
    needs: [test]
    steps:
    - name: Use the output
      run: |
        echo "The app version is ${{ needs.test.outputs.version }}"
